<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oseasy.initiate.modules.actyw.dao.ActYwGnodeDao">

	<sql id="actYwGnodeColumns">
		a.id AS "id",
		a.parent_id AS "parent.id",
		a.parent_ids AS "parentIds",
		a.group_id AS "groupId",
		a.type AS "type",
		a.typefun AS "typefun",
		a.node_id AS "nodeId",
		a.pre_id AS "preId",
		a.pre_ids AS "preIds",
		a.pre_idss AS "preIdss",
		a.pre_fun_id AS "preFunId",
		a.next_id AS "nextId",
		a.next_ids AS "nextIds",
		a.next_idss AS "nextIdss",
		a.next_fun_id AS "nextFunId",
		a.is_show AS "isShow",
		a.is_form AS "isForm",
		a.form_id AS "formId",
		a.sort AS "sort",
		a.office_id AS "office.id",
		a.update_date AS "updateDate",
		a.update_by AS "updateBy.id",
		a.create_date AS "createDate",
		a.create_by AS "createBy.id",
		a.remarks AS "remarks",
		a.flow_group AS "flowGroup",
		a.del_flag AS "delFlag",
		o7.name AS "office.name",

		p.id AS "parent.id",

		pe.id AS "preGnode.id",
		pe.del_flag AS "preGnode.delFlag",

		nt.id AS "nextGnode.id",
		nt.del_flag AS "nextGnode.delFlag",

		b.id AS "group.id",
		b.name AS "group.name",
		b.status AS "group.status",
		b.sort AS "group.sort",
		b.type AS "group.type",
		b.keyss AS "group.keyss",
		b.author AS "group.author",
		b.version AS "group.version",
		b.flow_id AS "group.flowId",
		b.update_date AS "group.updateDate",
		b.update_by AS "group.updateBy.id",
		b.create_date AS "group.createDate",
		b.create_by AS "group.createBy.id",
		b.remarks AS "group.remarks",
		b.del_flag AS "group.delFlag",

		c.id AS "node.id",
		c.name AS "node.name",
		c.type AS "node.type",
		c.level AS "node.level",
		c.is_sys AS "node.isSys",
		c.is_form AS "node.isForm",
		c.is_flow AS "node.isFlow",
		c.is_show AS "node.isShow",
		c.is_require AS "node.isRequire",
		c.is_group AS "node.isGroup",
		c.flow_group AS "node.flowGroup",
		c.node_type AS "node.nodeType",
		c.node_key AS "node.nodeKey",
		c.node_prekey AS "node.nodePrekey",
		c.node_nextkey AS "node.nodeNextkey",
		c.office_id AS "node.office.id",
		c.form_id AS "node.formId",
		c.flow_id AS "node.flowId",
		c.update_date AS "node.updateDate",
		c.update_by AS "node.updateBy.id",
		c.create_date AS "node.createDate",
		c.create_by AS "node.createBy.id",
		c.remarks AS "node.remarks",
		c.del_flag AS "node.delFlag",

		cp.id AS "parent.node.id",
		cp.name AS "parent.node.name",
		cp.type AS "parent.node.type",
		cp.level AS "parent.node.level",
		cp.is_sys AS "parent.node.isSys",
		cp.is_form AS "parent.node.isForm",
		cp.is_flow AS "parent.node.isFlow",
		cp.is_show AS "parent.node.isShow",
		cp.is_require AS "parent.node.isRequire",
		cp.is_group AS "parent.node.isGroup",
		cp.flow_group AS "parent.node.flowGroup",

		cpe.id AS "preGnode.node.id",
		cpe.name AS "preGnode.node.name",
		cpe.type AS "preGnode.node.type",
		cpe.level AS "preGnode.node.level",
		cpe.is_sys AS "preGnode.node.isSys",
		cpe.is_form AS "preGnode.node.isForm",
		cpe.is_flow AS "preGnode.node.isFlow",
		cpe.is_show AS "preGnode.node.isShow",
		cpe.is_require AS "preGnode.node.isRequire",
		cpe.is_group AS "preGnode.node.isGroup",
		cpe.flow_group AS "preGnode.node.flowGroup",

		cnt.id AS "nextGnode.node.id",
		cnt.name AS "nextGnode.node.name",
		cnt.type AS "nextGnode.node.type",
		cnt.level AS "nextGnode.node.level",
		cnt.is_sys AS "nextGnode.node.isSys",
		cnt.is_form AS "nextGnode.node.isForm",
		cnt.is_flow AS "nextGnode.node.isFlow",
		cnt.is_show AS "nextGnode.node.isShow",
		cnt.is_require AS "nextGnode.node.isRequire",
		cnt.is_group AS "nextGnode.node.isGroup",
		cnt.flow_group AS "nextGnode.node.flowGroup",

		f.id AS "form.id",
		f.name AS "form.name",
		f.pro_type AS "form.proType",
		f.type AS "form.type",
		f.model AS "form.model",
		f.params AS "form.params",
		f.path AS "form.path",
		f.content AS "form.content",
		f.office_id AS "form.office.id",
		f.update_date AS "form.updateDate",
		f.update_by AS "form.updateBy.id",
		f.create_date AS "form.createDate",
		f.create_by AS "form.createBy.id",
		f.remarks AS "form.remarks",
		f.del_flag AS "form.delFlag"
	</sql>

	<sql id="actYwGnodeJoins">
		LEFT JOIN act_yw_node c ON c.id = a.node_id
		LEFT JOIN act_yw_gnode pe ON pe.id = a.pre_id
		LEFT JOIN act_yw_node cpe ON cpe.id = pe.node_id
		LEFT JOIN act_yw_gnode nt ON nt.id = a.next_id
		LEFT JOIN act_yw_node cnt ON cnt.id = nt.node_id
		LEFT JOIN act_yw_gnode p ON p.id = a.parent_id
		LEFT JOIN act_yw_node cp ON cp.id = p.node_id
		LEFT JOIN act_yw_group b ON b.id = a.group_id
		LEFT JOIN act_yw_form f ON f.id = a.form_id
		LEFT JOIN sys_office o7 ON o7.id = a.office_id
	</sql>

	<select id="get" resultType="ActYwGnode">
		SELECT
			<include refid="actYwGnodeColumns"/>
		FROM act_yw_gnode a
		<include refid="actYwGnodeJoins"/>
		WHERE a.id = #{id}
	</select>

	<select id="findList" resultType="ActYwGnode">
		SELECT
			<include refid="actYwGnodeColumns"/>
		FROM act_yw_gnode a
		<include refid="actYwGnodeJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			AND b.del_flag = #{DEL_FLAG_NORMAL}
			AND c.del_flag = #{DEL_FLAG_NORMAL}

			<if test="group != null">
				<if test="group.id != null and group.id != ''">
					AND b.id = #{group.id}
				</if>
			</if>
			<if test="parent != null and parent.id != null and parent.id != ''">
				AND a.parent_id = #{parent.id}
			</if>
			<if test="parentIds != null and parentIds != ''">
				AND a.parent_ids LIKE
					<if test="dbName == 'oracle'">'%'||#{parentIds}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{parentIds}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{parentIds},'%')</if>
			</if>
			<if test="groupId != null and groupId != ''">
				AND a.group_id = #{groupId}
			</if>
			<if test="type != null and type != ''">
				AND a.type = #{type}
			</if>

			<if test="typefun != null and typefun != ''">
				AND a.typefun = #{typefun}
			</if>
			<if test="nodeId != null and nodeId != ''">
				AND a.node_id = #{nodeId}
			</if>
			<if test="preId != null and preId != ''">
				AND a.pre_id = #{preId}
			</if>
			<if test="preIds != null and preIds != ''">
				AND a.pre_ids LIKE
					<if test="dbName == 'oracle'">'%'||#{preIds}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{preIds}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{preIds},'%')</if>
			</if>
			<if test="preIdss != null and preIdss != ''">
				AND a.pre_idss LIKE
					<if test="dbName == 'oracle'">'%'||#{preIdss}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{preIdss}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{preIdss},'%')</if>
			</if>
			<if test="preFunId != null and preFunId != ''">
				AND a.pre_fun_id = #{preFunId}
			</if>
			<if test="nextId != null and nextId != ''">
				AND a.next_id = #{nextId}
			</if>
			<if test="nextIds != null and nextIds != ''">
				AND a.next_ids LIKE
					<if test="dbName == 'oracle'">'%'||#{nextIds}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{nextIds}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{nextIds},'%')</if>
			</if>
			<if test="nextIdss != null and nextIdss != ''">
				AND a.next_idss LIKE
					<if test="dbName == 'oracle'">'%'||#{nextIdss}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{nextIdss}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{nextIdss},'%')</if>
			</if>
			<if test="nextFunId != null and nextFunId != ''">
				AND a.next_fun_id = #{nextFunId}
			</if>
			<if test="isShow != null and isShow != ''">
				AND a.is_show = #{isShow}
			</if>
			<if test="isForm != null and isForm != ''">
				AND a.is_form = #{isForm}
			</if>
			<if test="formId != null and formId != ''">
				AND a.form_id = #{formId}
			</if>
			<if test="office != null and office.id != null and office.id != ''">
				AND a.office_id = #{office.id}
			</if>
			ORDER BY o7.name ASC, a.group_id, a.pre_idss, a.sort ASC, p.id ASC, b.sort ASC, a.update_date DESC
		</where>
	</select>

	<select id="findListByYw" resultType="ActYwGnode">
		SELECT
			<include refid="actYwGnodeColumns"/>
		FROM act_yw_gnode a
		<include refid="actYwGnodeJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			AND b.del_flag = #{DEL_FLAG_NORMAL}
			AND c.del_flag = #{DEL_FLAG_NORMAL}
			AND (a.type = '70 'or a.type ='19')

			<if test="group != null">
				<if test="group.id != null and group.id != ''">
					AND b.id = #{group.id}
				</if>
			</if>
			<if test="groupId != null and groupId != ''">
				AND a.group_id = #{groupId}
			</if>

			<if test="parent != null and parent.id != null and parent.id != ''">
				AND a.parent_id = #{parent.id}
			</if>
			<if test="parentIds != null and parentIds != ''">
				AND a.parent_ids LIKE
					<if test="dbName == 'oracle'">'%'||#{parentIds}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{parentIds}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{parentIds},'%')</if>
			</if>


			<if test="typefun != null and typefun != ''">
				AND a.typefun = #{typefun}
			</if>
			<if test="nodeId != null and nodeId != ''">
				AND a.node_id = #{nodeId}
			</if>
			<if test="preId != null and preId != ''">
				AND a.pre_id = #{preId}
			</if>
			<if test="preIds != null and preIds != ''">
				AND a.pre_ids LIKE
					<if test="dbName == 'oracle'">'%'||#{preIds}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{preIds}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{preIds},'%')</if>
			</if>
			<if test="preIdss != null and preIdss != ''">
				AND a.pre_idss LIKE
					<if test="dbName == 'oracle'">'%'||#{preIdss}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{preIdss}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{preIdss},'%')</if>
			</if>
			<if test="preFunId != null and preFunId != ''">
				AND a.pre_fun_id = #{preFunId}
			</if>
			<if test="nextId != null and nextId != ''">
				AND a.next_id = #{nextId}
			</if>
			<if test="nextIds != null and nextIds != ''">
				AND a.next_ids LIKE
					<if test="dbName == 'oracle'">'%'||#{nextIds}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{nextIds}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{nextIds},'%')</if>
			</if>
			<if test="nextIdss != null and nextIdss != ''">
				AND a.next_idss LIKE
					<if test="dbName == 'oracle'">'%'||#{nextIdss}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{nextIdss}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{nextIdss},'%')</if>
			</if>
			<if test="nextFunId != null and nextFunId != ''">
				AND a.next_fun_id = #{nextFunId}
			</if>
			<if test="isShow != null and isShow != ''">
				AND a.is_show = #{isShow}
			</if>
			<if test="isForm != null and isForm != ''">
				AND a.is_form = #{isForm}
			</if>
			<if test="formId != null and formId != ''">
				AND a.form_id = #{formId}
			</if>
			<if test="office != null and office.id != null and office.id != ''">
				AND a.office_id = #{office.id}
			</if>
			ORDER BY o7.name ASC, a.group_id, a.pre_idss, a.sort ASC, p.id ASC, b.sort ASC, a.update_date DESC
		</where>
	</select>

	<select id="findListByYwProcess" resultType="ActYwGnode">
		SELECT
			<include refid="actYwGnodeColumns"/>
		FROM act_yw_gnode a
		<include refid="actYwGnodeJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			AND b.del_flag = #{DEL_FLAG_NORMAL}
			AND c.del_flag = #{DEL_FLAG_NORMAL}
			AND a.type ='19'

			<if test="group != null">
				<if test="group.id != null and group.id != ''">
					AND b.id = #{group.id}
				</if>
			</if>
			<if test="parent != null and parent.id != null and parent.id != ''">
				AND a.parent_id = #{parent.id}
			</if>
			<if test="parentIds != null and parentIds != ''">
				AND a.parent_ids LIKE
					<if test="dbName == 'oracle'">'%'||#{parentIds}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{parentIds}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{parentIds},'%')</if>
			</if>
			<if test="groupId != null and groupId != ''">
				AND a.group_id = #{groupId}
			</if>

			<if test="typefun != null and typefun != ''">
				AND a.typefun = #{typefun}
			</if>
			<if test="nodeId != null and nodeId != ''">
				AND a.node_id = #{nodeId}
			</if>
			<if test="preId != null and preId != ''">
				AND a.pre_id = #{preId}
			</if>
			<if test="preIds != null and preIds != ''">
				AND a.pre_ids LIKE
					<if test="dbName == 'oracle'">'%'||#{preIds}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{preIds}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{preIds},'%')</if>
			</if>
			<if test="preIdss != null and preIdss != ''">
				AND a.pre_idss LIKE
					<if test="dbName == 'oracle'">'%'||#{preIdss}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{preIdss}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{preIdss},'%')</if>
			</if>
			<if test="preFunId != null and preFunId != ''">
				AND a.pre_fun_id = #{preFunId}
			</if>
			<if test="nextId != null and nextId != ''">
				AND a.next_id = #{nextId}
			</if>
			<if test="nextIds != null and nextIds != ''">
				AND a.next_ids LIKE
					<if test="dbName == 'oracle'">'%'||#{nextIds}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{nextIds}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{nextIds},'%')</if>
			</if>
			<if test="nextIdss != null and nextIdss != ''">
				AND a.next_idss LIKE
					<if test="dbName == 'oracle'">'%'||#{nextIdss}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{nextIdss}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{nextIdss},'%')</if>
			</if>
			<if test="nextFunId != null and nextFunId != ''">
				AND a.next_fun_id = #{nextFunId}
			</if>
			<if test="isShow != null and isShow != ''">
				AND a.is_show = #{isShow}
			</if>
			<if test="isForm != null and isForm != ''">
				AND a.is_form = #{isForm}
			</if>
			<if test="formId != null and formId != ''">
				AND a.form_id = #{formId}
			</if>
			<if test="office != null and office.id != null and office.id != ''">
				AND a.office_id = #{office.id}
			</if>
			ORDER BY o7.name ASC, a.group_id, a.pre_idss, a.sort ASC, p.id ASC, b.sort ASC, a.update_date DESC
		</where>
	</select>

	<select id="findAllList" resultType="ActYwGnode">
		SELECT
			<include refid="actYwGnodeColumns"/>
		FROM act_yw_gnode a
		<include refid="actYwGnodeJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			AND b.del_flag = #{DEL_FLAG_NORMAL}
			AND c.del_flag = #{DEL_FLAG_NORMAL}
			ORDER BY o7.name ASC, a.group_id, a.pre_idss, a.sort ASC, p.id ASC, b.sort ASC, a.update_date DESC
		</where>
	</select>

	<select id="findByParentIdsLike" resultType="ActYwGnode">
		SELECT
			a.id,
			a.parent_id AS "parent.id",
			a.parent_ids
		FROM act_yw_gnode a
		<include refid="actYwGnodeJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			AND b.del_flag = #{DEL_FLAG_NORMAL}
			AND c.del_flag = #{DEL_FLAG_NORMAL}
			AND a.parent_ids LIKE #{parentIds}
			ORDER BY o7.name ASC, a.group_id, a.pre_idss, a.sort ASC, p.id ASC, b.sort ASC, a.update_date DESC
		</where>
	</select>

	<select id="findListByGroup" resultType="ActYwGnode">
		SELECT
			<include refid="actYwGnodeColumns"/>
		FROM act_yw_gnode a
		<include refid="actYwGnodeJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			AND b.del_flag = #{DEL_FLAG_NORMAL}
			AND c.del_flag = #{DEL_FLAG_NORMAL}
			AND b.id = #{group.id}
			ORDER BY o7.name ASC, a.group_id, a.pre_idss, a.sort ASC, p.id ASC, b.sort ASC, a.update_date DESC
		</where>
	</select>

	<select id="findPreNextListByGroup" resultType="ActYwGnode">
		SELECT
			<include refid="actYwGnodeColumns"/>
		FROM act_yw_gnode a
		<include refid="actYwGnodeJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			AND b.del_flag = #{DEL_FLAG_NORMAL}
			AND c.del_flag = #{DEL_FLAG_NORMAL}
			AND b.id = #{group.id}
			<if test="node != null">
				<if test="node.id != null and node.id != ''">
					AND a.node_id = #{node.id}
				</if>
			</if>
			<if test="preId != null and preId != ''">
				AND a.pre_id = #{preId}
			</if>
			<if test="preGnode != null">
				<if test="preGnode.id != null and preGnode.id != ''">
					AND a.pre_id = #{preGnode.id}
				</if>
			</if>
			<if test="nextId != null and nextId != ''">
				AND a.next_id = #{nextId}
			</if>
			<if test="nextGnode != null">
				<if test="nextGnode.id != null and nextGnode.id != ''">
					AND a.next_id = #{nextGnode.id}
				</if>
			</if>
			ORDER BY o7.name ASC, a.group_id, a.pre_idss, a.sort ASC, p.id ASC, b.sort ASC, a.update_date DESC
		</where>
	</select>

	<insert id="insert">
		INSERT INTO act_yw_gnode(
			id,
			parent_id,
			parent_ids,
			group_id,
			type,
			typefun,
			node_id,
			pre_id,
			pre_ids,
			pre_idss,
			pre_fun_id,
			next_id,
			next_ids,
			next_idss,
			next_fun_id,
			is_show,
			is_form,
			form_id,
			sort,
			office_id,
			update_date,
			update_by,
			create_date,
			create_by,
			flow_group,
			remarks,
			del_flag
		) VALUES (
			#{id},
			#{parent.id},
			#{parentIds},
			#{groupId},
			#{type},
			#{typefun},
			#{nodeId},
			#{preId},
			#{preIds},
			#{preIdss},
			#{preFunId},
			#{nextId},
			#{nextIds},
			#{nextIdss},
			#{nextFunId},
			#{isShow},
			#{isForm},
			#{formId},
			#{sort},
			#{office.id},
			#{updateDate},
			#{updateBy.id},
			#{createDate},
			#{createBy.id},
			#{flowGroup},
			#{remarks},
			#{delFlag}
		)
	</insert>

	<update id="update">
		UPDATE act_yw_gnode SET
			parent_id = #{parent.id},
			parent_ids = #{parentIds},
			group_id = #{groupId},
			type = #{type},
			typefun = #{typefun},
			node_id = #{nodeId},
			pre_id = #{preId},
			pre_ids = #{preIds},
			pre_idss = #{preIdss},
			pre_fun_id = #{preFunId},
			next_id = #{nextId},
			next_ids = #{nextIds},
			next_idss = #{nextIdss},
			next_fun_id = #{nextFunId},
			is_show = #{isShow},
			is_form = #{isForm},
			form_id = #{formId},
			sort = #{sort},
			office_id = #{office.id},
			update_date = #{updateDate},
			update_by = #{updateBy.id},
			flow_group = #{flowGroup},
			remarks = #{remarks}
		WHERE id = #{id}
	</update>

	<update id="updateSort">
		UPDATE act_yw_gnode SET
			sort = #{sort}
		WHERE id = #{id}
	</update>

	<update id="updateParentIds">
		UPDATE act_yw_gnode SET
			parent_id = #{parent.id},
			parent_ids = #{parentIds}
		WHERE id = #{id}
	</update>

	<update id="delete">
		UPDATE act_yw_gnode SET
			del_flag = #{DEL_FLAG_DELETE}
		WHERE id = #{id} OR parent_ids LIKE '%,'||#{id}||',%'
	</update>

</mapper>